===== C:\Users\rverger\source\repos\MyFirstAppMobile\MyFirstAppMobile\Data\IEntriesRepository.cs =====

using MyFirstAppMobile.Models;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace MyFirstAppMobile.Data
{
    public interface IEntriesRepository
    {
        Task<IReadOnlyList<FitnessEntry>> GetAllAsync();
        Task<IReadOnlyList<FitnessEntry>> GetBySearchAsync(string search);
        Task AddAsync(FitnessEntry entry);
        Task DeleteAsync(Guid id);
        Task UpdateAsync(FitnessEntry entry);
        Task<FitnessEntry?> GetByIdAsync(Guid id);
    }
}



===== C:\Users\rverger\source\repos\MyFirstAppMobile\MyFirstAppMobile\Data\SqliteEntriesRepository.cs =====

using MyFirstAppMobile.Models;
using SQLite;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace MyFirstAppMobile.Data
{
    internal class SqliteEntriesRepository : IEntriesRepository
    {
        private readonly SQLiteAsyncConnection _db;
        private bool _initialized;

        public SqliteEntriesRepository(string dbPath)
        {
            _db = new SQLiteAsyncConnection(dbPath);
        }

        private async Task InitAsync()
        {
            if (_initialized) return;
            await _db.CreateTableAsync<FitnessEntry>();
            _initialized = true;
        }
        public async Task AddAsync(FitnessEntry entry)
        {
            await InitAsync();
            await _db.InsertAsync(entry);
        }

        public async Task DeleteAsync(Guid id)
        {
            await InitAsync();
            await _db.DeleteAsync<FitnessEntry>(id);
        }

        public async Task<IReadOnlyList<FitnessEntry>> GetAllAsync()
        {
            await InitAsync();
            return await _db.Table<FitnessEntry>()
                            .OrderByDescending(x => x.Date)
                            .ToListAsync();
        }

        public async Task UpdateAsync(FitnessEntry entry)
        {
            await InitAsync();
            await  _db.UpdateAsync(entry);
        }

        public async Task<FitnessEntry?> GetByIdAsync(Guid id)
        {
            await InitAsync();
            return await _db.Table<FitnessEntry>()
                            .Where(x => x.Id == id)
                            .FirstOrDefaultAsync();
        }

        public async Task<IReadOnlyList<FitnessEntry>> GetBySearchAsync(string search)
        {
            await InitAsync();
            if (string.IsNullOrEmpty(search))
                return await GetAllAsync();
            var pattern = search.Trim().ToLower();
            return await _db.Table<FitnessEntry>()
                            .Where(x =>  x.ActivityType.Contains(pattern) || x.Notes.Contains(pattern))
                            .OrderByDescending(x => x.Date)
                            .ToListAsync();
                            
        }
    }
}



===== C:\Users\rverger\source\repos\MyFirstAppMobile\MyFirstAppMobile\Interface\IPlatformLogger.cs =====

using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace MyFirstAppMobile.Interface
{
    public interface IPlatformLogger
    {
        void Log(string message);
    }
}



===== C:\Users\rverger\source\repos\MyFirstAppMobile\MyFirstAppMobile\Models\FitnessEntry.cs =====

using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using SQLite;

namespace MyFirstAppMobile.Models
{
    public class FitnessEntry
    {
        [PrimaryKey]
        public Guid Id { get; set; } = Guid.NewGuid();
        public DateTime Date { get; set; } = DateTime.Today;
        public string ActivityType { get; set; } = "";
        public int DurationMinutes { get; set; }
        public string Notes { get; set; } = "";
    }
}



===== C:\Users\rverger\source\repos\MyFirstAppMobile\MyFirstAppMobile\Platforms\Android\AndroidLogger.cs =====

using MyFirstAppMobile.Interface;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using Alog = Android.Util;

namespace MyFirstAppMobile.Platforms.Android
{
    public class AndroidLogger : IPlatformLogger
    {
        public void Log(string message)
        {
            Alog.Log.Debug("ANDROIDLOG", message);
        }
    }
}



===== C:\Users\rverger\source\repos\MyFirstAppMobile\MyFirstAppMobile\Platforms\Android\MainActivity.cs =====

using Android.App;
using Android.Content.PM;
using Android.OS;

namespace MyFirstAppMobile
{
    [Activity(Theme = "@style/Maui.SplashTheme", MainLauncher = true, LaunchMode = LaunchMode.SingleTop, ConfigurationChanges = ConfigChanges.ScreenSize | ConfigChanges.Orientation | ConfigChanges.UiMode | ConfigChanges.ScreenLayout | ConfigChanges.SmallestScreenSize | ConfigChanges.Density)]
    public class MainActivity : MauiAppCompatActivity
    {
    }
}



===== C:\Users\rverger\source\repos\MyFirstAppMobile\MyFirstAppMobile\Platforms\Android\MainApplication.cs =====

using Android.App;
using Android.Runtime;

namespace MyFirstAppMobile
{
    [Application]
    public class MainApplication : MauiApplication
    {
        public MainApplication(IntPtr handle, JniHandleOwnership ownership)
            : base(handle, ownership)
        {
        }

        protected override MauiApp CreateMauiApp() => MauiProgram.CreateMauiApp();
    }
}



===== C:\Users\rverger\source\repos\MyFirstAppMobile\MyFirstAppMobile\Platforms\iOS\AppDelegate.cs =====

using Foundation;

namespace MyFirstAppMobile
{
    [Register("AppDelegate")]
    public class AppDelegate : MauiUIApplicationDelegate
    {
        protected override MauiApp CreateMauiApp() => MauiProgram.CreateMauiApp();
    }
}



===== C:\Users\rverger\source\repos\MyFirstAppMobile\MyFirstAppMobile\Platforms\iOS\Program.cs =====

using ObjCRuntime;
using UIKit;

namespace MyFirstAppMobile
{
    public class Program
    {
        // This is the main entry point of the application.
        static void Main(string[] args)
        {
            // if you want to use a different Application Delegate class from "AppDelegate"
            // you can specify it here.
            UIApplication.Main(args, null, typeof(AppDelegate));
        }
    }
}



===== C:\Users\rverger\source\repos\MyFirstAppMobile\MyFirstAppMobile\Platforms\MacCatalyst\AppDelegate.cs =====

using Foundation;

namespace MyFirstAppMobile
{
    [Register("AppDelegate")]
    public class AppDelegate : MauiUIApplicationDelegate
    {
        protected override MauiApp CreateMauiApp() => MauiProgram.CreateMauiApp();
    }
}



===== C:\Users\rverger\source\repos\MyFirstAppMobile\MyFirstAppMobile\Platforms\MacCatalyst\Program.cs =====

using ObjCRuntime;
using UIKit;

namespace MyFirstAppMobile
{
    public class Program
    {
        // This is the main entry point of the application.
        static void Main(string[] args)
        {
            // if you want to use a different Application Delegate class from "AppDelegate"
            // you can specify it here.
            UIApplication.Main(args, null, typeof(AppDelegate));
        }
    }
}



===== C:\Users\rverger\source\repos\MyFirstAppMobile\MyFirstAppMobile\Platforms\Tizen\Main.cs =====

using System;
using Microsoft.Maui;
using Microsoft.Maui.Hosting;

namespace MyFirstAppMobile
{
    internal class Program : MauiApplication
    {
        protected override MauiApp CreateMauiApp() => MauiProgram.CreateMauiApp();

        static void Main(string[] args)
        {
            var app = new Program();
            app.Run(args);
        }
    }
}



===== C:\Users\rverger\source\repos\MyFirstAppMobile\MyFirstAppMobile\Platforms\Windows\App.xaml =====

<maui:MauiWinUIApplication
    x:Class="MyFirstAppMobile.WinUI.App"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:maui="using:Microsoft.Maui"
    xmlns:local="using:MyFirstAppMobile.WinUI">

</maui:MauiWinUIApplication>



===== C:\Users\rverger\source\repos\MyFirstAppMobile\MyFirstAppMobile\Platforms\Windows\App.xaml.cs =====

using Microsoft.UI.Xaml;

// To learn more about WinUI, the WinUI project structure,
// and more about our project templates, see: http://aka.ms/winui-project-info.

namespace MyFirstAppMobile.WinUI
{
    /// <summary>
    /// Provides application-specific behavior to supplement the default Application class.
    /// </summary>
    public partial class App : MauiWinUIApplication
    {
        /// <summary>
        /// Initializes the singleton application object.  This is the first line of authored code
        /// executed, and as such is the logical equivalent of main() or WinMain().
        /// </summary>
        public App()
        {
            this.InitializeComponent();
        }

        protected override MauiApp CreateMauiApp() => MauiProgram.CreateMauiApp();
    }

}



===== C:\Users\rverger\source\repos\MyFirstAppMobile\MyFirstAppMobile\ViewModels\EntriesViewModel.cs =====

using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using CommunityToolkit.Mvvm.Messaging;
using MyFirstAppMobile.Data;
using MyFirstAppMobile.Models;
using System.Collections.ObjectModel;

namespace MyFirstAppMobile.ViewModels
{
    public partial class EntriesViewModel : ObservableObject
    {
        private readonly IEntriesRepository _repo;
        public ObservableCollection<FitnessEntry> Entries { get; } = new();

        // Liste des options pour le Picker
        public List<string> SortOptions { get; } = new List<string>
    {
        "Date (Desc)",
        "Date (Asc)",
        "Duration (Desc)",
        "Duration (Asc)"
    };

        public List<string> FilterOptions { get; } = new List<string>
    {
        "Tout",
        "Semaine",
        "Mois"
    };

        private string _selectedFilter;
        public string SelectedFilter
        {
            get => _selectedFilter;
            set
            {
                if (_selectedFilter != value)
                {
                    _selectedFilter = value;
                    OnPropertyChanged();
                    _ = Refresh();
                }
            }
        }

        private string _selectedSort;
        public string SelectedSort
        {
            get => _selectedSort;
            set
            {
                if (_selectedSort != value)
                {
                    _selectedSort = value;
                    OnPropertyChanged();
                    _ = Refresh(); ; // On retrie dès que la sélection change
                }
            }
        }

        public EntriesViewModel(IEntriesRepository repo)
        {
            _repo = repo;
            // Handler de réception du message venant du formulaire pour une nouvelel EntryFitness
            WeakReferenceMessenger.Default.Register<NewEntryMessage>(this, async (r, m) =>
            {
                await _repo.AddAsync(m.Value);
                await Refresh();
            });

            //Handler de réception pour modification d'un EntryFitness
            WeakReferenceMessenger.Default.Register<UpdateEntryMessage>(this, async (r, m) =>
            {
                await _repo.UpdateAsync(m.Value);
                await Refresh();
            });
        }

        private readonly SemaphoreSlim _semaphore = new(1, 1);

        [ObservableProperty]
        private bool isLoading;
        public bool CanInteract => !IsLoading;
        partial void OnIsLoadingChanged(bool value)
        {
            OnPropertyChanged(nameof(CanInteract));
        }

        [RelayCommand]
        public async Task Load()
        {
            if (!await _semaphore.WaitAsync(0))
                return;

            try
            {
                IsLoading = true;
                var all = await _repo.GetAllAsync();
                ReplaceEntries(all);
            }
            finally
            {
                IsLoading = false;
                _semaphore.Release();
            }
        }

        private string _currentSearch = string.Empty;

        public async Task Refresh()
        {
            if (!await _semaphore.WaitAsync(0)) return;
            try
            {
                IsLoading = true;

                var all = await _repo.GetAllAsync();
                var now = DateTime.Now;

                if (_selectedFilter == "Semaine")
                    all = all.Where(i => i.Date >= now.AddDays(-7)).ToList();
                else if (_selectedFilter == "Mois")
                    all = all.Where(i => i.Date.Month == now.Month && i.Date.Year == now.Year).ToList();

                if (!string.IsNullOrWhiteSpace(_currentSearch))
                {
                    var p = _currentSearch.Trim();
                    all = all.Where(x =>
                        (x.ActivityType?.Contains(p, StringComparison.OrdinalIgnoreCase) ?? false) ||
                        (x.Notes?.Contains(p, StringComparison.OrdinalIgnoreCase) ?? false)
                    ).ToList();
                }

                IEnumerable<FitnessEntry> ordered = SelectedSort switch
                {
                    "Date (Desc)" => all.OrderByDescending(i => i.Date),
                    "Date (Asc)" => all.OrderBy(i => i.Date),
                    "Duration (Desc)" => all.OrderByDescending(i => i.DurationMinutes),
                    "Duration (Asc)" => all.OrderBy(i => i.DurationMinutes),
                    _ => all
                };

                ReplaceEntries(ordered);
            }
            finally
            {
                IsLoading = false;
                _semaphore.Release();
            }
        }

        #region Commands

        [RelayCommand]
        public async Task Add()
        {
            await Shell.Current.GoToAsync(nameof(EntryPage));
        }

        [RelayCommand]
        public async Task Edit(Guid id)
        {
            await Shell.Current.GoToAsync(nameof(EntryPage), new Dictionary<string, object>
            {
                ["EntryId"] = id
            });
        }

        [RelayCommand]
        public async Task ShowDetails(Guid id)
        {
            await Shell.Current.GoToAsync(nameof(DetailsEntryPage), new Dictionary<string, object>
            {
                ["EntryId"] = id
            });
        }

        [RelayCommand]
        public async Task Delete(Guid id)
        {
            await _repo.DeleteAsync(id);
            var fe = Entries.FirstOrDefault(e => e.Id == id);
            if (fe is null)
                return;
            Entries.Remove(fe);
        }
        #endregion

        #region Searching
        [ObservableProperty]
        private string searchText;

        partial void OnSearchTextChanged(string value)
        {
            _ = Search(value);
        }

        private CancellationTokenSource? _searchCts;

        [RelayCommand]
        public async Task Search(string search)
        {
            _searchCts?.Cancel();
            _searchCts = new CancellationTokenSource();
            var token = _searchCts.Token;

            try
            {
                await Task.Delay(300, token); // debounce
                if (token.IsCancellationRequested)
                    return;

                _currentSearch = search;
                await Refresh();
            }
            catch (TaskCanceledException)
            {
                // Ignore
            }
        }
        #endregion

        public void ReplaceEntries(IEnumerable<FitnessEntry> entries)
        {
            Entries.Clear();
            foreach (var entry in entries)
            {
                Entries.Add(entry);
            }
        }
    }
}



===== C:\Users\rverger\source\repos\MyFirstAppMobile\MyFirstAppMobile\ViewModels\EntryDetailsViewModel.cs =====

using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using CommunityToolkit.Mvvm.Messaging;
using CommunityToolkit.Mvvm.Messaging.Messages;
using MyFirstAppMobile.Data;
using MyFirstAppMobile.Models;
using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace MyFirstAppMobile.ViewModels
{
    public partial class EntryDetailsViewModel : ObservableObject
    {
        private Guid? _id;
        private readonly IEntriesRepository _repo;

        public EntryDetailsViewModel(IEntriesRepository repo)
        {
            _repo = repo;
        }

        [ObservableProperty]
        private DateTime date = DateTime.Today;

        // Propriétés pour le formulaire (liées aux champs de saisie)
        [ObservableProperty]
        private string activityType;

        [ObservableProperty]
        private string durationMinutes;

        [ObservableProperty]
        private string notes;

        [ObservableProperty]
        private bool isBusy;

        
        internal async Task LoadForShowDetailsAsync(Guid id)
        {
            _id = id;

            var entry = await _repo.GetByIdAsync(id);
            if (entry is null)
            {
                await Shell.Current.DisplayAlert("Erreur", "Erreur sur le chargement", "OK");
                return;
            }

            ActivityType = entry.ActivityType;
            DurationMinutes = entry.DurationMinutes.ToString();
            Notes = entry.Notes;
            Date = entry.Date;
        }
    }
}



===== C:\Users\rverger\source\repos\MyFirstAppMobile\MyFirstAppMobile\ViewModels\EntryFormViewModel.cs =====

using CommunityToolkit.Mvvm.ComponentModel;
using CommunityToolkit.Mvvm.Input;
using CommunityToolkit.Mvvm.Messaging;
using CommunityToolkit.Mvvm.Messaging.Messages;
using MyFirstAppMobile.Data;
using MyFirstAppMobile.Models;
using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace MyFirstAppMobile.ViewModels
{
    public partial class EntryFormViewModel : ObservableObject
    {
        private Guid? _editId;
        private readonly IEntriesRepository _repo;

        public EntryFormViewModel(IEntriesRepository repo)
        {
            _repo = repo;
        }

        [ObservableProperty]
        private DateTime date = DateTime.Today;

        // Propriétés pour le formulaire (liées aux champs de saisie)
        [ObservableProperty]
        private string activityType;

        [ObservableProperty]
        private string durationMinutes;

        [ObservableProperty]
        private string notes;

        [ObservableProperty]
        private bool isBusy;

        public bool CanSave => !IsBusy;
        partial void OnIsBusyChanged(bool value) => OnPropertyChanged(nameof(CanSave));

        [RelayCommand]
        public async Task Save()
        {
            if (IsBusy) return;
            IsBusy = true;

            try
            {
                if (string.IsNullOrEmpty(ActivityType) || !int.TryParse(DurationMinutes, out int durationConv) || durationConv <= 0)
                {
                    await Shell.Current.DisplayAlert("Erreur", "Type d'activité obligatoire et durée > 0", "OK");
                    return;
                }

                // 1. On crée le nouvel objet avec les données saisies
                var entry = new FitnessEntry
                {
                    ActivityType = ActivityType,
                    DurationMinutes = durationConv,
                    Notes = Notes,
                    Date = Date
                };

                if (_editId is null)
                {
                    // 2. On l'ajoute à la liste
                    WeakReferenceMessenger.Default.Send(new NewEntryMessage(entry));
                }
                else
                {
                    entry.Id = (Guid)_editId;
                    WeakReferenceMessenger.Default.Send(new UpdateEntryMessage(entry));
                }

                // 4. On revient en arrière
                await Shell.Current.GoToAsync("..");
            }
            finally
            {
                IsBusy = false;
            }
        }

        [RelayCommand]
        public async Task Cancel()
        {
            await Shell.Current.GoToAsync("..");
        }

        internal async Task LoadForEditAsync(Guid id)
        {
            _editId = id;

            var entry = await _repo.GetByIdAsync(id);
            if (entry is null)
            {
                await Shell.Current.DisplayAlert("Erreur", "Erreur sur le chargement", "OK");
                return;
            }

            ActivityType = entry.ActivityType;
            DurationMinutes = entry.DurationMinutes.ToString();
            Notes = entry.Notes;
            Date = entry.Date;
        }

        internal void ResetForCreate()
        {
            _editId = null;
            ActivityType = "";
            DurationMinutes = "0";
            Notes = "";
            Date = DateTime.Today;
        }
    }
    // Message strongly-typed
    public sealed class NewEntryMessage : ValueChangedMessage<FitnessEntry>
    {
        public NewEntryMessage(FitnessEntry value) : base(value) { }
    }

    public sealed class UpdateEntryMessage : ValueChangedMessage<FitnessEntry>
    {
        public UpdateEntryMessage(FitnessEntry value) : base(value) { }
    }
}



===== C:\Users\rverger\source\repos\MyFirstAppMobile\MyFirstAppMobile\App.xaml =====

<?xml version = "1.0" encoding = "UTF-8" ?>
<Application xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:local="clr-namespace:MyFirstAppMobile"
             x:Class="MyFirstAppMobile.App">
    <Application.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="Resources/Styles/Colors.xaml" />
                <ResourceDictionary Source="Resources/Styles/Styles.xaml" />
            </ResourceDictionary.MergedDictionaries>
        </ResourceDictionary>
    </Application.Resources>
</Application>



===== C:\Users\rverger\source\repos\MyFirstAppMobile\MyFirstAppMobile\App.xaml.cs =====

using System.Diagnostics;

namespace MyFirstAppMobile
{
    public partial class App : Application
    {
        public App()
        {
            InitializeComponent();
        }

        protected override Window CreateWindow(IActivationState? activationState)
        {
            return new Window(new AppShell());
        }
    }
}



===== C:\Users\rverger\source\repos\MyFirstAppMobile\MyFirstAppMobile\AppShell.xaml =====

<?xml version="1.0" encoding="UTF-8" ?>
<Shell
    x:Class="MyFirstAppMobile.AppShell"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:local="clr-namespace:MyFirstAppMobile"
    Title="MyFirstAppMobile">

    <ShellContent
        Title="Home"
        ContentTemplate="{DataTemplate local:MainPage}"
        Route="MainPage" />

</Shell>



===== C:\Users\rverger\source\repos\MyFirstAppMobile\MyFirstAppMobile\AppShell.xaml.cs =====

namespace MyFirstAppMobile
{
    public partial class AppShell : Shell
    {
        public AppShell()
        {
            InitializeComponent();

            Routing.RegisterRoute(nameof(EntryPage), typeof(EntryPage));
            Routing.RegisterRoute(nameof(DetailsEntryPage), typeof(DetailsEntryPage));
        }
    }
}



===== C:\Users\rverger\source\repos\MyFirstAppMobile\MyFirstAppMobile\DefaultLogger.cs =====

using MyFirstAppMobile.Interface;
using System;
using System.Collections.Generic;
using System.Diagnostics;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace MyFirstAppMobile
{
    public class DefaultLogger : IPlatformLogger
    {
        public void Log(string message)
        {
            Debug.WriteLine(message);
        }
    }
}



===== C:\Users\rverger\source\repos\MyFirstAppMobile\MyFirstAppMobile\DetailEntryPage.xaml =====

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MyFirstAppMobile.DetailsEntryPage"
             Title="DÃ©tail ActivitÃ©">
    <ScrollView>
        <VerticalStackLayout Padding="20" Spacing="15">

            <Frame BackgroundColor="{StaticResource Primary}" HasShadow="True">
                <Label Text="{Binding ActivityType}" 
                       TextColor="White" 
                       FontSize="24" 
                       FontAttributes="Bold" 
                       HorizontalOptions="Center"/>
            </Frame>
            <Label Text="Date : " />
            <Label Text="{Binding Date, StringFormat='{0:dd/MM/yyyy}'}" />
            <BoxView HeightRequest="1" Color="LightGray" Margin="0,10"/>
            <Label Text="DurÃ©e (minutes) : " />
            <Label Text="{Binding DurationMinutes}" />
            <BoxView HeightRequest="1" Color="LightGray" Margin="0,10"/>
            <Label Text="Notes additionnelles : " />
            <Label Text="{Binding Notes}" />
        </VerticalStackLayout>
    </ScrollView>
</ContentPage>



===== C:\Users\rverger\source\repos\MyFirstAppMobile\MyFirstAppMobile\DetailEntryPage.xaml.cs =====

using CommunityToolkit.Mvvm.Input;
using MyFirstAppMobile.ViewModels;

namespace MyFirstAppMobile;

public partial class DetailsEntryPage : ContentPage, IQueryAttributable
{
    private readonly EntryDetailsViewModel _viewModel;
    public DetailsEntryPage(EntryDetailsViewModel viewModel)
	{
		InitializeComponent();
        _viewModel = viewModel;
        BindingContext = viewModel;
    }

    async void IQueryAttributable.ApplyQueryAttributes(IDictionary<string, object> query)
    {
        if (query.TryGetValue("EntryId", out var value) && value is Guid id)
            await _viewModel.LoadForShowDetailsAsync(id);
    }
}



===== C:\Users\rverger\source\repos\MyFirstAppMobile\MyFirstAppMobile\EntryPage.xaml =====

<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="MyFirstAppMobile.EntryPage"
             Title="EntryPage">
    <VerticalStackLayout Padding="20" Spacing="15">
        <Label Text="Nouvelle ActivitÃ©" FontSize="24" FontAttributes="Bold" />

        <Entry Placeholder="Type d'activitÃ© (ex: Course)" 
           Text="{Binding ActivityType, Mode=TwoWay}" />

        <Entry Placeholder="DurÃ©e (minutes)" 
           Text="{Binding DurationMinutes, Mode=TwoWay}" 
           Keyboard="Numeric" />

        <Editor Placeholder="Notes additionnelles" 
            Text="{Binding Notes, Mode=TwoWay}"
            HeightRequest="100" />

        <Label Text="Date : " FontSize="16"/>
        <DatePicker 
            Date="{Binding Date, Mode=TwoWay}" />
        
        <Button Text="Enregistrer" 
            Command="{Binding SaveCommand}"
            IsEnabled="{Binding CanSave}"
            BackgroundColor="Green"
            TextColor="White" />

        <Button Text="Annuler" 
            Command="{Binding CancelCommand}"
            BackgroundColor="Gray" />
    </VerticalStackLayout>
</ContentPage>



===== C:\Users\rverger\source\repos\MyFirstAppMobile\MyFirstAppMobile\EntryPage.xaml.cs =====

using MyFirstAppMobile.Models;
using MyFirstAppMobile.ViewModels;
using System.Threading.Tasks;

namespace MyFirstAppMobile;

public partial class EntryPage : ContentPage, IQueryAttributable
{
	private readonly EntryFormViewModel _viewModel;

    public EntryPage(EntryFormViewModel vm)
	{
		InitializeComponent();
        _viewModel = vm;
		BindingContext = vm;
	}

    async void IQueryAttributable.ApplyQueryAttributes(IDictionary<string, object> query)
    {
        if (query.TryGetValue("EntryId", out var value) && value is Guid id)
            await _viewModel.LoadForEditAsync(id);
        else
            _viewModel.ResetForCreate();
    }

}



===== C:\Users\rverger\source\repos\MyFirstAppMobile\MyFirstAppMobile\LifecycleLogger.cs =====

using MyFirstAppMobile.Interface;
using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;

namespace MyFirstAppMobile;

public class LifecycleLogger
{
    private readonly IPlatformLogger _logger;

    public LifecycleLogger(IPlatformLogger logger)
    {
        _logger = logger;
    }

    public void Log(string messsage) => _logger.Log(messsage);
}



===== C:\Users\rverger\source\repos\MyFirstAppMobile\MyFirstAppMobile\MainPage.xaml =====

<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:MyFirstAppMobile.ViewModels"
             xmlns:models="clr-namespace:MyFirstAppMobile.Models"
             x:Class="MyFirstAppMobile.MainPage"
             x:DataType="viewmodels:EntriesViewModel">
    <VerticalStackLayout Padding="16" Spacing="12">
        <ActivityIndicator IsRunning="{Binding IsLoading}" />
        <SearchBar Placeholder="Search items..." Text="{Binding SearchText}" />
        <Button Text="Nouvelle entrée"
                IsEnabled="{Binding CanInteract}"
                Command="{Binding AddCommand}" />
        <HorizontalStackLayout Spacing="5" HorizontalOptions="Center">
            <Picker Title="Choisir un tri"
                ItemsSource="{Binding SortOptions}"
                SelectedItem="{Binding SelectedSort}" />
            <Picker Title="Choisir un filtre"
                ItemsSource="{Binding FilterOptions}"
                SelectedItem="{Binding SelectedFilter}" />
            <!--<Button Text="Tout" Clicked="OnFilterAllClicked" />
            <Button Text="Semaine" Clicked="OnFilterWeekClicked" />
            <Button Text="Mois" Clicked="OnFilterMonthClicked" />-->
        </HorizontalStackLayout>

        <CollectionView ItemsSource="{Binding Entries}" EmptyView="Aucune donnée disponible pour le moment.">
            <CollectionView.ItemTemplate>
                <DataTemplate x:DataType="models:FitnessEntry">
                    <SwipeView>
                        <SwipeView.RightItems>
                            <SwipeItems Mode="Execute">
                                <SwipeItem Text="Supprimer"
                           Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:EntriesViewModel}}, Path=DeleteCommand}"
                           CommandParameter="{Binding Id}" />
                            </SwipeItems>
                        </SwipeView.RightItems>

                        <VerticalStackLayout Padding="12">
                            <Label Text="{Binding ActivityType}" HorizontalOptions="Fill" FontSize="18"/>
                            <Label Text="{Binding DurationMinutes, StringFormat='Durée: {0} min'}" />
                            <Label Text="{Binding Date, StringFormat='Date: {0:dd/MM/yyyy}'}" />
                            <Label Text="{Binding Notes}" FontAttributes="Italic"/>
                            <HorizontalStackLayout Spacing="5" HorizontalOptions="Center">
                                <Button Text="Modifier" 
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:EntriesViewModel}}, Path=EditCommand}"
                                    CommandParameter="{Binding Id}"/>
                                <Button Text="Détails" 
                                Command="{Binding Source={RelativeSource AncestorType={x:Type viewmodels:EntriesViewModel}}, Path=ShowDetailsCommand}"
                            CommandParameter="{Binding Id}"/>
                            </HorizontalStackLayout>
                        </VerticalStackLayout>
                    </SwipeView>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>
    </VerticalStackLayout>
</ContentPage>



===== C:\Users\rverger\source\repos\MyFirstAppMobile\MyFirstAppMobile\MainPage.xaml.cs =====

using CommunityToolkit.Mvvm.ComponentModel;
using MyFirstAppMobile.ViewModels;
using System.Windows.Input;

namespace MyFirstAppMobile
{
    public partial class MainPage : ContentPage
    {
        public MainPage(EntriesViewModel viewModel)
        {
            InitializeComponent();
            BindingContext = viewModel;
        }

        async void OnTextChanged(object sender, EventArgs e)
        {
            SearchBar searchBar = (SearchBar)sender;

            if (BindingContext is EntriesViewModel viewModel)
            {
                await viewModel.SearchCommand.ExecuteAsync(searchBar.Text);
            }
        }
        protected override async void OnAppearing()
        {
            base.OnAppearing();

            if (BindingContext is EntriesViewModel viewModel)
            {
                await viewModel.LoadCommand.ExecuteAsync(null);
            }
        }
    }
}



===== C:\Users\rverger\source\repos\MyFirstAppMobile\MyFirstAppMobile\MauiProgram.cs =====

using Microsoft.Extensions.Logging;
using Microsoft.Maui.LifecycleEvents;
using MyFirstAppMobile.Data;
using MyFirstAppMobile.Interface;
using MyFirstAppMobile.ViewModels;


namespace MyFirstAppMobile
{
    public static class MauiProgram
    {
        public static MauiApp CreateMauiApp()
        {

            var builder = MauiApp.CreateBuilder();
#if ANDROID
            builder.Services.AddSingleton<IPlatformLogger, Platforms.Android.AndroidLogger>();
#else
            builder.Services.AddSingleton<IPlatformLogger, DefaultLogger>();
#endif
            builder.Services.AddSingleton<LifecycleLogger>();
            var dbPath = Path.Combine(FileSystem.AppDataDirectory, "fitness.db3");
            builder.Services.AddSingleton<IEntriesRepository>(_ => new SqliteEntriesRepository(dbPath));

            builder.Services.AddSingleton<EntriesViewModel>();
            builder.Services.AddTransient<EntryFormViewModel>();
            builder.Services.AddTransient<EntryDetailsViewModel>();

            builder.Services.AddSingleton<MainPage>();
            builder.Services.AddTransient<EntryPage>();
            builder.Services.AddTransient<DetailsEntryPage>();

            builder.UseMauiApp<App>()
                .ConfigureFonts(fonts =>
                {
                    fonts.AddFont("OpenSans-Regular.ttf", "OpenSansRegular");
                    fonts.AddFont("OpenSans-Semibold.ttf", "OpenSansSemibold");
                });

#if DEBUG
            builder.Logging.AddDebug();
#endif
            return builder.Build();
        }
    }
}



